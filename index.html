import { useState, useEffect, useRef, useCallback } from â€œreactâ€;

const AVATARS = [â€˜ğŸ˜â€™,â€˜ğŸ¤©â€™,â€˜ğŸ˜‚â€™,â€˜ğŸ¥³â€™,â€˜ğŸ˜â€™,â€˜ğŸ¤”â€™,â€˜ğŸ˜œâ€™,â€˜ğŸ™ƒâ€™,â€˜ğŸ¦Šâ€™,â€˜ğŸ¯â€™];

// â”€â”€ Storage helpers â”€â”€
async function roomGet(code) {
try {
const r = await window.storage.get(`room:${code}`, true);
return r ? JSON.parse(r.value) : null;
} catch { return null; }
}
async function roomSet(code, data) {
try { await window.storage.set(`room:${code}`, JSON.stringify(data), true); }
catch(e) { console.error(â€˜storage set errorâ€™, e); }
}

// â”€â”€ Tiny UI atoms â”€â”€
const Input = ({placeholder, value, onChange, style={}, maxLength, â€¦rest}) => (
<input
value={value} onChange={e=>onChange(e.target.value)}
placeholder={placeholder} maxLength={maxLength}
style={{
width:â€˜100%â€™, padding:â€˜13px 16pxâ€™,
background:â€™#1e1e2eâ€™, border:â€˜2px solid #2e2e45â€™,
borderRadius:13, color:â€™#f0ede8â€™,
fontFamily:â€˜Tajawal,sans-serifâ€™, fontSize:16,
outline:â€˜noneâ€™, direction:â€˜rtlâ€™, boxSizing:â€˜border-boxâ€™, â€¦style
}}
onFocus={e=>e.target.style.borderColor=â€™#ff6b35â€™}
onBlur={e=>e.target.style.borderColor=â€™#2e2e45â€™}
{â€¦rest}
/>
);

const Btn = ({children, onClick, variant=â€˜primaryâ€™, disabled, style={}}) => {
const base = {
width:â€˜100%â€™, padding:â€˜14pxâ€™, border:â€˜noneâ€™, borderRadius:15,
fontFamily:â€˜Tajawal,sans-serifâ€™, fontSize:17, fontWeight:700,
cursor: disabled ? â€˜not-allowedâ€™ : â€˜pointerâ€™,
marginTop:8, opacity: disabled ? 0.5 : 1, transition:â€˜all 0.2sâ€™, â€¦style
};
const variants = {
primary: { background:â€˜linear-gradient(135deg,#ff6b35,#ff8c5a)â€™, color:â€™#fffâ€™ },
secondary: { background:â€™#1e1e2eâ€™, color:â€™#4ecdc4â€™, border:â€˜2px solid #2e2e45â€™ },
ghost: { background:â€˜noneâ€™, color:â€™#666â€™, fontSize:14, padding:â€˜10pxâ€™, width:â€˜autoâ€™ }
};
return <button style={{...base,...variants[variant]}} onClick={disabled?null:onClick}>{children}</button>;
};

const Card = ({children, style={}}) => (

  <div style={{
    background:'#16161f', borderRadius:26, padding:'32px 28px',
    boxShadow:'0 8px 40px rgba(0,0,0,0.5)', border:'1px solid #2e2e45',
    position:'relative', overflow:'hidden', ...style
  }}>
    <div style={{position:'absolute',top:0,left:0,right:0,height:3,background:'linear-gradient(90deg,#ff6b35,#4ecdc4)'}}/>
    {children}
  </div>
);

const ErrMsg = ({msg}) => msg ? (

  <div style={{background:'rgba(231,76,60,0.12)',border:'1px solid rgba(231,76,60,0.3)',color:'#e74c3c',
    padding:'11px 15px',borderRadius:12,fontSize:14,textAlign:'center',marginBottom:12}}>
    {msg}
  </div>
) : null;

const Dots = () => (
<span style={{display:â€˜flexâ€™,gap:5,justifyContent:â€˜centerâ€™,marginBottom:8}}>
{[0,1,2].map(i=>(
<span key={i} style={{width:8,height:8,borderRadius:â€˜50%â€™,
background:[â€™#ff6b35â€™,â€™#4ecdc4â€™,â€™#ffe66dâ€™][i],
animation:â€˜pulse 1.2s ease infiniteâ€™, animationDelay:`${i*0.2}s`}}/>
))}
</span>
);

export default function App() {
const [screen, setScreen] = useState(â€˜homeâ€™); // home|lobby|write|guess|scores
const [myName, setMyName] = useState(â€™â€™);
const [nameInput, setNameInput] = useState(â€™â€™);
const [codeInput, setCodeInput] = useState(â€™â€™);
const [roomCode, setRoomCode] = useState(â€™â€™);
const [amHost, setAmHost] = useState(false);
const [room, setRoom] = useState(null);
const [err, setErr] = useState(â€™â€™);
const [storyText, setStoryText] = useState(â€™â€™);
const [submitted, setSubmitted] = useState(false);
const [guessedThisRound, setGuessedThisRound] = useState(false);
const [toastMsg, setToastMsg] = useState(â€™â€™);
const [toastType, setToastType] = useState(â€™â€™);
const [copyLabel, setCopyLabel] = useState(â€˜Ù†Ø³Ø®â€™);
const [shuffledOpts, setShuffledOpts] = useState([]);
const pollRef = useRef(null);
const lastStoryRef = useRef(-1);

const showErr = (msg) => { setErr(msg); setTimeout(()=>setErr(â€™â€™),4000); };

// â”€â”€ Poll â”€â”€
const startPoll = useCallback((code) => {
if (pollRef.current) clearInterval(pollRef.current);
pollRef.current = setInterval(async () => {
const r = await roomGet(code);
if (r) setRoom(r);
}, 2000);
}, []);

const stopPoll = () => { if(pollRef.current){clearInterval(pollRef.current);pollRef.current=null;} };

// â”€â”€ React to room changes â”€â”€
useEffect(() => {
if (!room) return;
if (room.phase === â€˜writingâ€™ && screen !== â€˜writeâ€™) {
setScreen(â€˜writeâ€™);
setSubmitted(false);
setStoryText(â€™â€™);
}
if (room.phase === â€˜guessingâ€™) {
const idx = room.currentStory;
if (idx !== lastStoryRef.current || screen !== â€˜guessâ€™) {
lastStoryRef.current = idx;
setGuessedThisRound(false);
setToastMsg(â€™â€™);
setShuffledOpts([â€¦room.players].sort(()=>Math.random()-0.5));
setScreen(â€˜guessâ€™);
}
}
if (room.phase === â€˜scoresâ€™ && screen !== â€˜scoresâ€™) {
stopPoll();
setScreen(â€˜scoresâ€™);
}
}, [room]);

// â”€â”€ Host: auto-start guessing when all wrote â”€â”€
useEffect(() => {
if (!room || !amHost || room.phase !== â€˜writingâ€™) return;
const allDone = room.players.every(p=>p.storySubmitted);
if (allDone && room.stories.length === room.players.length) {
(async()=>{
const fresh = await roomGet(roomCode);
if (!fresh || fresh.phase !== â€˜writingâ€™) return;
fresh.shuffledStories = [â€¦fresh.stories].sort(()=>Math.random()-0.5);
fresh.currentStory = 0;
fresh.phase = â€˜guessingâ€™;
fresh.guesses = {};
await roomSet(roomCode, fresh);
})();
}
}, [room, amHost]);

// â”€â”€ CREATE â”€â”€
const createRoom = async () => {
const name = nameInput.trim();
if (!name) { showErr(â€˜âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹â€™); return; }
const code = Math.floor(1000+Math.random()*9000).toString();
const r = {
code, host: name, phase: â€˜lobbyâ€™,
players: [{name, avatar: AVATARS[0], storySubmitted: false}],
stories: [], shuffledStories: [], scores: {[name]:0},
currentStory: 0, guesses: {}, created: Date.now()
};
await roomSet(code, r);
setMyName(name); setRoomCode(code); setAmHost(true); setRoom(r);
setScreen(â€˜lobbyâ€™);
startPoll(code);
};

// â”€â”€ JOIN â”€â”€
const joinRoom = async () => {
const name = nameInput.trim();
const code = codeInput.trim();
if (!name) { showErr(â€˜âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹â€™); return; }
if (code.length !== 4) { showErr(â€˜âš ï¸ Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ© (4 Ø£Ø±Ù‚Ø§Ù…)â€™); return; }
const r = await roomGet(code);
if (!r) { showErr(â€˜âŒ Ø§Ù„ØºØ±ÙØ© Ù…Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©â€™); return; }
if (r.phase !== â€˜lobbyâ€™) { showErr(â€˜âš ï¸ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¯Ø£Øªâ€™); return; }
if (r.players.find(p=>p.name===name)) { showErr(â€˜âš ï¸ Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ØŒ ØºÙŠÙ‘Ø± Ø§Ø³Ù…Ùƒâ€™); return; }
const avatar = AVATARS[r.players.length % AVATARS.length];
r.players.push({name, avatar, storySubmitted: false});
r.scores[name] = 0;
await roomSet(code, r);
setMyName(name); setRoomCode(code); setAmHost(false); setRoom(r);
setScreen(â€˜lobbyâ€™);
startPoll(code);
};

// â”€â”€ START GAME â”€â”€
const startGame = async () => {
const r = await roomGet(roomCode);
if (!r) return;
r.phase = â€˜writingâ€™;
r.stories = []; r.shuffledStories = []; r.guesses = {}; r.currentStory = 0;
r.players.forEach(p=>{p.storySubmitted=false; r.scores[p.name]=0;});
await roomSet(roomCode, r);
};

// â”€â”€ SUBMIT STORY â”€â”€
const submitStory = async () => {
if (storyText.trim().length < 10) { showErr(â€˜âš ï¸ Ø§ÙƒØªØ¨ Ø³Ø§Ù„ÙØ© Ø£Ø·ÙˆÙ„ Ø´ÙˆÙŠ!â€™); return; }
const r = await roomGet(roomCode);
if (!r) return;
r.stories.push({player: myName, text: storyText.trim()});
const me = r.players.find(p=>p.name===myName);
if (me) me.storySubmitted = true;
await roomSet(roomCode, r);
setRoom(r);
setSubmitted(true);
};

// â”€â”€ MAKE GUESS â”€â”€
const makeGuess = async (guessed) => {
if (guessedThisRound || !room) return;
setGuessedThisRound(true);
const correct = room.shuffledStories[room.currentStory]?.player;
const fresh = await roomGet(roomCode);
if (!fresh.guesses) fresh.guesses = {};
if (!fresh.guesses[room.currentStory]) fresh.guesses[room.currentStory] = {};
fresh.guesses[room.currentStory][myName] = guessed;
if (guessed === correct && myName !== correct) {
fresh.scores[myName] = (fresh.scores[myName]||0) + 1;
}
await roomSet(roomCode, fresh);
setRoom(fresh);
if (guessed === correct) {
setToastMsg(`âœ… ØµØ­! Ø§Ù„Ø³Ø§Ù„ÙØ© Ù„Ù€ ${correct} ğŸ‰`); setToastType(â€˜winâ€™);
} else {
setToastMsg(`âŒ ØºÙ„Ø·! Ø§Ù„Ø³Ø§Ù„ÙØ© ÙƒØ§Ù†Øª Ù„Ù€ ${correct} ğŸ˜…`); setToastType(â€˜loseâ€™);
}
};

// â”€â”€ NEXT ROUND â”€â”€
const nextRound = async () => {
if (!amHost) return;
const r = await roomGet(roomCode);
const nextIdx = r.currentStory + 1;
if (nextIdx >= r.shuffledStories.length) r.phase = â€˜scoresâ€™;
else { r.currentStory = nextIdx; r.phase = â€˜guessingâ€™; }
await roomSet(roomCode, r);
};

// â”€â”€ PLAY AGAIN â”€â”€
const playAgain = async () => {
const r = await roomGet(roomCode);
r.phase=â€˜lobbyâ€™; r.stories=[]; r.shuffledStories=[]; r.guesses={}; r.currentStory=0;
r.players.forEach(p=>{p.storySubmitted=false; r.scores[p.name]=0;});
await roomSet(roomCode, r);
setRoom(r); lastStoryRef.current=-1;
setScreen(â€˜lobbyâ€™); startPoll(roomCode);
};

const goHome = () => {
stopPoll();
setMyName(â€™â€™); setRoomCode(â€™â€™); setAmHost(false); setRoom(null);
setNameInput(â€™â€™); setCodeInput(â€™â€™);
lastStoryRef.current=-1; setScreen(â€˜homeâ€™);
};

const copyCode = () => {
navigator.clipboard.writeText(roomCode).then(()=>{
setCopyLabel(â€˜âœ“ ØªÙ…â€™); setTimeout(()=>setCopyLabel(â€˜Ù†Ø³Ø®â€™),2000);
});
};

// â”€â”€ CSS animations injected â”€â”€
useEffect(()=>{
const s=document.createElement(â€˜styleâ€™);
s.textContent=`@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap'); @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}} @keyframes pop{0%{transform:scale(0.85);opacity:0}70%{transform:scale(1.04)}100%{transform:scale(1);opacity:1}} @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}`;
document.head.appendChild(s);
return ()=>s.remove();
},[]);

const wrap = {
minHeight:â€˜100vhâ€™, background:â€™#0f0f15â€™,
backgroundImage:â€˜radial-gradient(ellipse at 20% 20%,rgba(255,107,53,0.06) 0%,transparent 60%),radial-gradient(ellipse at 80% 80%,rgba(78,205,196,0.06) 0%,transparent 60%)â€™,
display:â€˜flexâ€™, alignItems:â€˜centerâ€™, justifyContent:â€˜centerâ€™, padding:16,
fontFamily:â€˜Tajawal,sans-serifâ€™, direction:â€˜rtlâ€™
};
const inner = {width:â€˜100%â€™, maxWidth:500, animation:â€˜fadeUp 0.4s easeâ€™};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCREENS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// HOME
if (screen === â€˜homeâ€™) return (
<div style={wrap}><div style={inner}>
<Card>
<div style={{textAlign:â€˜centerâ€™,marginBottom:28}}>
<div style={{fontSize:60,marginBottom:10}}>ğŸ­</div>
<h1 style={{fontSize:26,fontWeight:900,background:â€˜linear-gradient(135deg,#ff6b35,#4ecdc4)â€™,
WebkitBackgroundClip:â€˜textâ€™,WebkitTextFillColor:â€˜transparentâ€™,backgroundClip:â€˜textâ€™,margin:0}}>
Ø®Ù…Ù‘Ù† ØµØ§Ø­Ø¨ Ø§Ù„Ø³Ø§Ù„ÙØ©
</h1>
<p style={{color:â€™#666â€™,fontSize:14,marginTop:6}}>ÙƒÙ„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø¬ÙˆØ§Ù„Ù‡ â€” ÙƒÙ„ ÙˆØ§Ø­Ø¯ ÙŠÙƒØªØ¨ Ø³Ø§Ù„ÙØªÙ‡!</p>
</div>

```
    <div style={{marginBottom:16}}>
      <label style={{display:'block',fontSize:12,fontWeight:700,color:'#666',marginBottom:8,textTransform:'uppercase',letterSpacing:0.5}}>Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</label>
      <Input value={nameInput} onChange={setNameInput} placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ..." maxLength={20}/>
    </div>

    <ErrMsg msg={err}/>
    <Btn onClick={createRoom}>ğŸ  Ø£Ù†Ø´Ø¦ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</Btn>

    <div style={{display:'flex',alignItems:'center',gap:12,margin:'18px 0',color:'#444',fontSize:13}}>
      <div style={{flex:1,height:1,background:'#2e2e45'}}/> Ø£Ùˆ <div style={{flex:1,height:1,background:'#2e2e45'}}/>
    </div>

    <div style={{marginBottom:16}}>
      <label style={{display:'block',fontSize:12,fontWeight:700,color:'#666',marginBottom:8,textTransform:'uppercase',letterSpacing:0.5}}>Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©</label>
      <Input value={codeInput} onChange={v=>setCodeInput(v.replace(/\D/g,''))}
        placeholder="Ù…Ø«Ù„: 4829" maxLength={4}
        style={{textAlign:'center',fontSize:26,letterSpacing:8,fontWeight:900}}/>
    </div>
    <Btn onClick={joinRoom} variant="secondary">ğŸšª Ø§Ø¯Ø®Ù„ Ø§Ù„ØºØ±ÙØ©</Btn>
  </Card>
</div></div>
```

);

// LOBBY
if (screen === â€˜lobbyâ€™) {
const r = room;
return (
<div style={wrap}><div style={inner}>
<Card>
{/* Room code */}
<div style={{background:â€™#1e1e2eâ€™,border:â€˜2px solid #ffe66dâ€™,borderRadius:16,padding:18,
textAlign:â€˜centerâ€™,marginBottom:20,position:â€˜relativeâ€™}}>
<div style={{fontSize:11,color:â€™#666â€™,marginBottom:4}}>Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ© â€” Ø´Ø§Ø±ÙƒÙ‡ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ</div>
<div style={{fontSize:40,fontWeight:900,letterSpacing:10,color:â€™#ffe66dâ€™}}>{roomCode}</div>
<button onClick={copyCode} style={{position:â€˜absoluteâ€™,top:10,left:10,background:â€™#2e2e45â€™,
border:â€˜noneâ€™,color:â€™#888â€™,padding:â€˜5px 11pxâ€™,borderRadius:7,fontSize:12,cursor:â€˜pointerâ€™,
fontFamily:â€˜Tajawal,sans-serifâ€™}}>
{copyLabel}
</button>
</div>

```
      <div style={{fontSize:12,fontWeight:700,color:'#555',textTransform:'uppercase',letterSpacing:0.5,marginBottom:10}}>
        Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† ({r?.players?.length || 0})
      </div>

      <div style={{display:'flex',flexDirection:'column',gap:8,marginBottom:20}}>
        {r?.players?.map((p,i)=>(
          <div key={p.name} style={{display:'flex',alignItems:'center',gap:12,padding:'11px 15px',
            background:'#1e1e2e',borderRadius:12,border:'1px solid #2e2e45',animation:'pop 0.3s ease'}}>
            <div style={{width:36,height:36,borderRadius:'50%',background:'linear-gradient(135deg,#ff6b35,#4ecdc4)',
              display:'flex',alignItems:'center',justifyContent:'center',fontSize:18,flexShrink:0}}>{p.avatar}</div>
            <div style={{fontWeight:700,fontSize:15}}>{p.name}</div>
            <div style={{marginRight:'auto',fontSize:12,color: p.name===r.host ? '#ffe66d' : '#4ecdc4'}}>
              {p.name===r.host ? 'ğŸ‘‘ Ù…Ø¶ÙŠÙ' : 'âœ… Ø¬Ø§Ù‡Ø²'}
            </div>
          </div>
        ))}
      </div>

      <ErrMsg msg={err}/>

      {amHost ? (
        <Btn onClick={startGame} disabled={!r || r.players.length < 2}>
          {r?.players?.length < 2 ? 'â³ Ø§Ù†ØªØ¸Ø± Ù„Ø§Ø¹Ø¨ Ø«Ø§Ù†ÙŠ...' : `ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© (${r?.players?.length} Ù„Ø§Ø¹Ø¨ÙŠÙ†)`}
        </Btn>
      ) : (
        <div style={{textAlign:'center',padding:'16px 0'}}>
          <Dots/>
          <p style={{color:'#555',fontSize:14,marginTop:6}}>Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¶ÙŠÙ ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©...</p>
        </div>
      )}
    </Card>
  </div></div>
);
```

}

// WRITE
if (screen === â€˜writeâ€™) return (
<div style={wrap}><div style={inner}>
<Card>
<div style={{display:â€˜flexâ€™,justifyContent:â€˜space-betweenâ€™,alignItems:â€˜centerâ€™,
padding:â€˜9px 14pxâ€™,background:â€™#1e1e2eâ€™,borderRadius:11,marginBottom:20,border:â€˜1px solid #2e2e45â€™}}>
<span style={{fontSize:13,color:â€™#555â€™}}>Ø§ÙƒØªØ¨ Ø³Ø§Ù„ÙØªÙƒ</span>
<span style={{background:â€˜rgba(255,107,53,0.18)â€™,color:â€™#ff6b35â€™,padding:â€˜3px 11pxâ€™,
borderRadius:20,fontSize:12,fontWeight:700}}>Ø¯ÙˆØ±Ùƒ! ğŸ‘‹</span>
</div>

```
    <div style={{display:'inline-flex',alignItems:'center',gap:6,background:'rgba(255,107,53,0.12)',
      color:'#ff6b35',padding:'4px 13px',borderRadius:20,fontSize:13,fontWeight:700,marginBottom:14}}>
      ğŸ‘¤ {myName}
    </div>

    <div style={{background:'rgba(78,205,196,0.08)',border:'1px solid rgba(78,205,196,0.2)',
      borderRadius:11,padding:'11px 14px',fontSize:13,color:'#4ecdc4',marginBottom:16}}>
      ğŸ’¡ Ø§ÙƒØªØ¨ Ø³Ø§Ù„ÙØ© Ø­ØµÙ„Øª Ù…Ø¹Ùƒ Ø¨Ø¯ÙˆÙ† Ù…Ø§ ØªØ°ÙƒØ± Ø§Ø³Ù…Ùƒ â€” Ø§Ù„Ø¨Ø§Ù‚ÙŠÙ† Ø±Ø§Ø­ ÙŠØ®Ù…Ù‘Ù†ÙˆÙ†!
    </div>

    {!submitted ? (
      <>
        <textarea value={storyText} onChange={e=>setStoryText(e.target.value)}
          placeholder="ÙƒØ§Ù† ÙŠÙˆÙ… Ø¹Ø§Ø¯ÙŠ ÙˆØ£Ù†Ø§ Ø±Ø§ÙŠØ­..."
          style={{width:'100%',padding:'14px 16px',background:'#1e1e2e',border:'2px solid #2e2e45',
            borderRadius:13,color:'#f0ede8',fontFamily:'Tajawal,sans-serif',fontSize:15,
            minHeight:130,resize:'vertical',outline:'none',direction:'rtl',lineHeight:1.7,
            boxSizing:'border-box',marginBottom:16}}
          onFocus={e=>e.target.style.borderColor='#4ecdc4'}
          onBlur={e=>e.target.style.borderColor='#2e2e45'}
        />
        <ErrMsg msg={err}/>
        <Btn onClick={submitStory}>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø§Ù„ÙØ© âœ“</Btn>
      </>
    ) : (
      <div style={{textAlign:'center',padding:'24px 0'}}>
        <Dots/>
        <p style={{color:'#555',fontSize:14,marginTop:8}}>
          ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„! Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ù‚ÙŠØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†...
          {room && ` (${room.players.filter(p=>p.storySubmitted).length}/${room.players.length})`}
        </p>
      </div>
    )}
  </Card>
</div></div>
```

);

// GUESS
if (screen === â€˜guessâ€™ && room) {
const storyIdx = room.currentStory;
const story = room.shuffledStories?.[storyIdx];
const total = room.shuffledStories?.length || 1;
const guessCount = Object.keys(room.guesses?.[storyIdx]||{}).length;
const voters = room.players.length - 1;
const myGuess = room.guesses?.[storyIdx]?.[myName];
const correct = story?.player;
const showNext = amHost || guessCount >= voters || guessedThisRound;

```
return (
  <div style={wrap}><div style={inner}>
    <Card>
      <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:18}}>
        <span style={{background:'rgba(255,107,53,0.15)',color:'#ff6b35',padding:'5px 14px',
          borderRadius:20,fontSize:13,fontWeight:700}}>
          Ø³Ø§Ù„ÙØ© {storyIdx+1} Ù…Ù† {total}
        </span>
        {guessedThisRound && <span style={{fontSize:12,color:'#555'}}>Ø®Ù…Ù‘Ù† {guessCount}/{voters}</span>}
      </div>

      {/* Story */}
      <div style={{background:'#1e1e2e',borderRadius:16,padding:'22px 18px',marginBottom:24,
        border:'1px solid #2e2e45',fontSize:16,lineHeight:1.85,position:'relative'}}>
        <div style={{fontSize:50,color:'rgba(255,107,53,0.12)',position:'absolute',top:-6,left:12,
          lineHeight:1,fontFamily:'Georgia,serif'}}>â</div>
        <div style={{paddingTop:8}}>{story?.text}</div>
      </div>

      <div style={{fontSize:12,fontWeight:700,color:'#555',textTransform:'uppercase',letterSpacing:0.5,marginBottom:12}}>
        Ù…ÙŠÙ† ØµØ§Ø­Ø¨ Ù‡Ø§Ù„Ø³Ø§Ù„ÙØ©ØŸ
      </div>

      <div style={{display:'flex',flexDirection:'column',gap:9,marginBottom:16}}>
        {shuffledOpts.map((p,i)=>{
          const isGuessed = myGuess === p.name;
          const isCorrect = p.name === correct;
          let style = {
            background:'#1e1e2e', border:'2px solid #2e2e45', borderRadius:13,
            padding:'13px 16px', display:'flex', alignItems:'center', gap:14,
            cursor: guessedThisRound ? 'default' : 'pointer',
            fontFamily:'Tajawal,sans-serif', fontSize:15, fontWeight:600,
            color:'#f0ede8', textAlign:'right', width:'100%',
            animation:`pop 0.3s ease ${i*0.05}s both`, transition:'all 0.2s'
          };
          if (guessedThisRound && isCorrect) { style.borderColor='#4ecdc4'; style.background='rgba(78,205,196,0.1)'; style.color='#4ecdc4'; }
          if (guessedThisRound && isGuessed && !isCorrect) { style.borderColor='#e74c3c'; style.background='rgba(231,76,60,0.1)'; style.color='#e74c3c'; }

          return (
            <button key={p.name} style={style}
              onClick={()=>!guessedThisRound && makeGuess(p.name)}>
              <span style={{minWidth:30,height:30,borderRadius:8,background:'#2e2e45',
                display:'flex',alignItems:'center',justifyContent:'center',
                fontSize:13,fontWeight:900,color:'#555',flexShrink:0}}>
                {i+1}
              </span>
              {p.name}
              {guessedThisRound && isCorrect && <span style={{marginRight:'auto'}}>âœ“</span>}
            </button>
          );
        })}
      </div>

      {toastMsg && (
        <div style={{padding:'13px 18px',borderRadius:13,textAlign:'center',fontSize:15,fontWeight:700,
          marginBottom:14,animation:'pop 0.3s ease',
          background: toastType==='win' ? 'rgba(78,205,196,0.14)' : 'rgba(231,76,60,0.12)',
          color: toastType==='win' ? '#4ecdc4' : '#e74c3c',
          border: `1px solid ${toastType==='win' ? 'rgba(78,205,196,0.3)' : 'rgba(231,76,60,0.2)'}`}}>
          {toastMsg}
        </div>
      )}

      {showNext && guessedThisRound && amHost && (
        <Btn onClick={nextRound}>
          {storyIdx+1 < total ? 'Ø§Ù„ØªØ§Ù„ÙŠ â†' : 'ğŸ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬'}
        </Btn>
      )}
      {showNext && guessedThisRound && !amHost && guessCount >= voters && (
        <div style={{textAlign:'center',color:'#555',fontSize:13,marginTop:8}}>
          <Dots/><p style={{marginTop:6}}>Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¶ÙŠÙ ÙŠÙ†ØªÙ‚Ù„ Ù„Ù„ØªØ§Ù„ÙŠ...</p>
        </div>
      )}
    </Card>
  </div></div>
);
```

}

// SCORES
if (screen === â€˜scoresâ€™ && room) {
const sorted = Object.entries(room.scores||{}).sort((a,b)=>b[1]-a[1]);
const medals = [â€˜ğŸ¥‡â€™,â€˜ğŸ¥ˆâ€™,â€˜ğŸ¥‰â€™];
const winner = sorted[0]?.[0];

```
return (
  <div style={wrap}><div style={inner}>
    <Card>
      <div style={{textAlign:'center',marginBottom:24}}>
        <div style={{fontSize:60,marginBottom:8}}>ğŸ†</div>
        <h1 style={{fontSize:24,fontWeight:900,margin:0,
          background:'linear-gradient(135deg,#ff6b35,#ffe66d)',
          WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent',backgroundClip:'text'}}>
          Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        </h1>
        {winner && <p style={{color:'#666',marginTop:6,fontSize:14}}>ğŸ‰ Ø§Ù„ÙØ§Ø¦Ø²: {winner}!</p>}
      </div>

      <div style={{display:'flex',flexDirection:'column',gap:10,marginBottom:24}}>
        {sorted.map(([name,pts],i)=>(
          <div key={name} style={{display:'flex',alignItems:'center',gap:14,padding:'13px 16px',
            background: i===0 ? 'rgba(255,230,109,0.06)' : '#1e1e2e',
            borderRadius:13, border: `1px solid ${i===0 ? '#ffe66d44' : '#2e2e45'}`,
            animation:`pop 0.4s ease ${i*0.08}s both`}}>
            <span style={{fontSize:22,minWidth:30,textAlign:'center'}}>{medals[i]||'ğŸ–ï¸'}</span>
            <span style={{fontWeight:700,fontSize:15,flex:1}}>{name}</span>
            <span style={{background: i===0 ? 'rgba(255,230,109,0.2)' : 'rgba(255,107,53,0.18)',
              color: i===0 ? '#ffe66d' : '#ff6b35',
              padding:'4px 14px',borderRadius:20,fontSize:14,fontWeight:700}}>
              {pts} Ù†Ù‚Ø·Ø©
            </span>
          </div>
        ))}
      </div>

      {amHost && <Btn onClick={playAgain}>ğŸ” Ø¬ÙˆÙ„Ø© Ø«Ø§Ù†ÙŠØ©</Btn>}
      {!amHost && (
        <div style={{textAlign:'center',padding:'8px 0'}}>
          <Dots/><p style={{color:'#555',fontSize:14,marginTop:6}}>Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¶ÙŠÙ...</p>
        </div>
      )}
      <Btn onClick={goHome} variant="ghost" style={{display:'block',margin:'8px auto 0'}}>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</Btn>
    </Card>
  </div></div>
);
```

}

return <div style={{â€¦wrap,color:â€™#666â€™}}>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div>;
}
